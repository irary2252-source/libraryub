<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ç³»ç»Ÿç™»å½• - å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</title>
  <style>
    body { font-family: "Microsoft YaHei", sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%); margin: 0; }
    .login-box { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); width: 350px; text-align: center; }
    h1 { margin-bottom: 20px; color: #333; }
    .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #eee; }
    .tab { flex: 1; padding: 10px; cursor: pointer; color: #666; font-weight: bold; }
    .tab.active { color: #007bff; border-bottom: 3px solid #007bff; }
    .form-group { margin-bottom: 15px; text-align: left; }
    label { display: block; margin-bottom: 5px; color: #555; }
    input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
    button { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; margin-top: 10px; }
    button:hover { background-color: #0056b3; }
    .error-msg { color: red; font-size: 14px; margin-top: 10px; display: none; }
  </style>
</head>
<body>

<div class="login-box">
  <h1>ğŸ“š å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ</h1>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('admin')">ğŸ‘¨â€ğŸ’¼ ç®¡ç†å‘˜ç™»å½•</div>
    <div class="tab" onclick="switchTab('reader')">ğŸ“– è¯»è€…ç™»å½•</div>
  </div>

  <div id="adminForm">
    <div class="form-group">
      <label>è´¦å·</label>
      <input type="text" id="adminUser" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜è´¦å· (admin)">
    </div>
    <div class="form-group">
      <label>å¯†ç </label>
      <input type="password" id="adminPass" placeholder="è¯·è¾“å…¥å¯†ç ">
    </div>
    <button onclick="doLoginAdmin()">ç™»å½•ç³»ç»Ÿ</button>
  </div>

  <div id="readerForm" style="display: none;">
    <div class="form-group">
      <label>å€Ÿä¹¦è¯å·</label>
      <input type="text" id="readerCard" placeholder="è¯·è¾“å…¥æ‚¨çš„å¡å·">
    </div>
    <div class="form-group">
      <label>å¯†ç </label>
      <input type="password" id="readerPass" placeholder="è¯·è¾“å…¥å¯†ç  (é»˜è®¤123456)">
    </div>
    <button onclick="doLoginReader()" style="background-color: #28a745;">è¯»è€…ç™»å½•</button>
  </div>

  <div id="errorMsg" class="error-msg"></div>
</div>

<script>
  function switchTab(type) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('errorMsg').style.display = 'none';

    if (type === 'admin') {
      document.getElementById('adminForm').style.display = 'block';
      document.getElementById('readerForm').style.display = 'none';
    } else {
      document.getElementById('adminForm').style.display = 'none';
      document.getElementById('readerForm').style.display = 'block';
    }
  }

  async function doLoginAdmin() {
    const username = document.getElementById('adminUser').value;
    const password = document.getElementById('adminPass').value;
    if(!username || !password) return showErr("è¯·è¾“å…¥å®Œæ•´ä¿¡æ¯");

    try {
      const res = await fetch('/api/login/admin', {
        method: 'POST', headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ username, password })
      });
      const data = await res.json();
      if(data.success) {
        localStorage.setItem('role', 'admin'); // è®°å½•ç™»å½•çŠ¶æ€
        window.location.href = 'admin.html';   // è·³è½¬åˆ°ç®¡ç†é¡µ
      } else {
        showErr(data.msg);
      }
    } catch(e) { showErr("ç½‘ç»œé”™è¯¯"); }
  }

  async function doLoginReader() {
    const cardId = document.getElementById('readerCard').value;
    const password = document.getElementById('readerPass').value;
    if(!cardId || !password) return showErr("è¯·è¾“å…¥å®Œæ•´ä¿¡æ¯");

    try {
      const res = await fetch('/api/login/reader', {
        method: 'POST', headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ cardId, password })
      });
      const data = await res.json();
      if(data.success) {
        localStorage.setItem('role', 'reader'); // è®°å½•ç™»å½•çŠ¶æ€
        localStorage.setItem('cardId', cardId); // è®°å½•å½“å‰å¡å·
        window.location.href = 'reader.html';   // è·³è½¬åˆ°è¯»è€…é¡µ
      } else {
        showErr(data.msg);
      }
    } catch(e) { showErr("ç½‘ç»œé”™è¯¯"); }
  }

  function showErr(msg) {
    const div = document.getElementById('errorMsg');
    div.innerText = msg;
    div.style.display = 'block';
  }
</script>
</body>
</html>